
<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta property="og:title" content=" Create your own WebTop in php/js in no time &middot;  The Nexus" />
    <meta property="og:site_name" content="The Nexus" />
    <meta property="og:url" content="http://zteo.com/posts/create-your-own-webtop-in-phpjs-in-no-time/" />

    
    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content="2007-01-01T04:00:00Z" />
    

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta name="twitter:title" content="Create your own WebTop in php/js in no time" />
    
    <meta name="twitter:description" content="They are everywhere: protopage, pageflakes, netvibes et al are free, easy to use -as long as you have a powerful browser- and moderatly eye-pleasing." />
    <meta name="twitter:url" content="http://zteo.com/posts/create-your-own-webtop-in-phpjs-in-no-time/" />
    

    <title> Create your own WebTop in php/js in no time &middot;  The Nexus</title>

    <link rel="preload" href="http://zteo.com//css/fontawesome-all.min.css" as="style" />
    <link rel="preload" href="http://zteo.com//js/main.js" as="script" />
    <link rel="preload" href="http://zteo.com//css/main.css" as="style" />
    
    <link href="/mermaid/mermaid.cfr.css?1604186989" type="text/css" rel="stylesheet" />
    
    
    <link rel="webmention" href="https://webmention.io/zteo.com/webmention" />
    <link rel="pingback" href="https://webmention.io/zteo.com/xmlrpc" />
    
    
    <link rel="preload" href="http://zteo.com//css/cfr.css" as="style" />
    <link rel="stylesheet" href="http://zteo.com//css/main.css">
    <link rel="stylesheet" href="http://zteo.com//css/pure-min.css">
    <link rel="preload" href="http://zteo.com//js/basicLightbox.min.js" as="script" />
    <link rel="stylesheet" href="http://zteo.com//css/basicLightbox.min.css">
    <link rel="stylesheet" href="http://zteo.com//css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="http://zteo.com//css/cfr.css">
    <link rel="stylesheet" href="http://zteo.com//css/syntax.css">
    
    
    


    
    <meta name="description" content="Create your own WebTop in php/js in no time" />
    

    
    <meta name="p:domain_verify" content=""/>
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    

    
    <link href="http://zteo.com/index.xml" rel="alternate" type="application/rss+xml" title="The Nexus" />
    

    
    <link rel="canonical" href="http://zteo.com/posts/create-your-own-webtop-in-phpjs-in-no-time/" />

    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http:\/\/zteo.com\/posts\/create-your-own-webtop-in-phpjs-in-no-time\/"
        },
        "headline": "Create your own WebTop in php\/js in no time",
        "description": "Create your own WebTop in php\/js in no time",
        "author": {
            "@type": "Person",
            "name": " ",
            "url": "http://profiles.google.com/?rel=author",
            "image": {
              "@type": "ImageObject",
              "url": "https:",
              "height": 80,
              "width": 80
            }
        },
        "publisher": {
          "@type": "Organization",
          "@id": "http:\/\/zteo.com\/",
          "name": "The Nexus",
          "url": "http:\/\/zteo.com\/",
          "logo": {
            "@type": "ImageObject",
            "url": "https:",
            "height": 80,
            "width": 80
          }
        },
        
        "image": {
          "@type": "ImageObject",
          "url": "",
          "height": 80,
          "width": 80
        },
        "datePublished": "2007-01-01",
        "dateModified": "2007-01-01",
        "wordCount":  992 ,
        
    }
    </script>
    

    
    <script type="text/javascript">
        
        
    </script>
    

    <script type="text/javascript">
        var config = {
            baseUrl: "http:\/\/zteo.com\/"
        };
    </script>

</head>
<body class="home-template">
<div id="loader-wrapper">
    <div id="loader"></div>
</div>
<section id="wrapper" style="display: none;">
    <div id="ajax-container">
        <nav id="nav" class="nav">
            <div class="nav-logo">
                <a href="http://zteo.com/">
                    
                    The Nexus
                    
                </a>
            </div>

            <nav id="nav2" role="navigation">
                <a href="#nav" title="Show navigation">Show navigation</a>
                <a href="#" title="Hide navigation">Hide navigation</a>
                <ul class="clearfix">
                    <li><a href="http://zteo.com/">BLOG</a></li>
                    <li>
                        <a href="http://zteo.com/meta/about" aria-haspopup="true"><span>ABOUT</span></a>
                        <ul>
                            <li><a href="http://zteo.com/meta/egosurfing">Ego Surfing</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="http://zteo.com/projects/projects-list" aria-haspopup="true"><span>PROJECTS</span></a>
                        <ul>
                            <li><a href="http://zteo.com/projects/n2">n2</a></li>
                            <li><a href="http://zteo.com/projects/s2ajax">S2ajax</a></li>
                            <li><a href="http://zteo.com/projects/condo">Condo</a></li>
                            <li><a href="http://zteo.com/projects/ezedit">ezEdit</a></li>
                            <li><a href="http://zteo.com/projects/freeblog">FreeBlog - Air</a></li>
                            <li><a href="http://zteo.com/projects/tooredo-alpha">Tooredo Alpha</a></li>
                            <li><a href="http://zteo.com/projects/tools">Tools</a></li>
                            <li><a href="http://zteo.com/projects/journler-again">Journlr, Again!</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>


            <div id="main-menu" class="nav-menu">
                
                
                <a id="search-button" onclick="$('#search-form').toggle();" title="Search"><i class="fa fa-search"></i></a>
                <form id="search-form" method="get" role="search" action="https://google.com/search">
                    <input type="hidden" name="as_sitesearch" value="http://zteo.com/">
                    <input type="text" name="q" maxlength="255" placeholder="Search..." class="form-control">
                    <input type="submit" value="Search">
                </form>
                
                
                
                
            </div>
        </nav>


<style>
@media(min-width:1024px) {
	main {
		display: grid;
		grid-template-columns: 100% 100%;
	}
}

</style>

<main class="content" role="main">
    <article class="post post-with-bg">
        <div class="inner">

            <div id="push">

                <header class="post-header">
                
                    <span class="post-meta">
                        <span class="post-date">1 Jan 2007</span> <span class="reading-time">| <span class="estimated-reading-time">5 min.</span> (<span class="word-count">992</span> words)</span></span>
                    </span>
                <div class="clear"></div>
                
                <h1 class="post-title">Create your own WebTop in php/js in no time</h1>
              </header>

              <section class="post-content">
                

                
                
                


                
                    <p>They are everywhere: <a href="http://www.protopage.com/">protopage</a>,
<a href="http://www.pageflakes.com/">pageflakes</a>, <a href="http://www.netvibes.com/">netvibes</a>
et al are free, easy to use -as long as you have a powerful browser- and
moderatly eye-pleasing.</p>
<p><strong>SO?</strong></p>
<p>A couple months ago, I wondered how long it would take me to build my own
&lsquo;WebTop&rsquo; (<a href="http://home.clicdev.com/">You can play with it here</a>). The
challenge would be to get it to a satisfactory state over a week-end.<br>
Of course, I decided to use existing open-source code for the applications&rsquo;
primary needs.</p>
<p><em>These needs being</em> :<br>
1. Users should be able to play with the application without being logged in<br>
2. They need to know that if they do log in, the state of their webtop will
be memorized for their next session<br>
3. Webtops are windows-based; webtops&rsquo; dimensions are virtually unlimited and
windows can be laid out anywhere in that immense space.<br>
4. Also, windows may need to be iconified and when they are, displaying a
relevant icon would provide great visual clues.</p>
<p>I decided to use these four libraries:</p>
<ul>
<li>Sebastien Gruhier&rsquo;s <a href="http://prototype-window.xilinus.com/">Prototype Window</a></li>
<li>Mohamed Ahmed&rsquo;s <a href="http://www.maaking.com/demos/login/">Users Login System</a></li>
<li>Michal Migursky and Matt Knapp&rsquo;s <a href="http://pear.php.net/pepr/pepr-proposal-show.php?id=198">Json class</a></li>
<li>InputParser.php, which I extracted from my very own <a href="http://www.nextbbs.com/">nextBBS</a>&rsquo; source tree</li>
</ul>
<p>Oh, and the wonderfully simplistic red icons are the creation of <a href="http://somerandomdude.net/srd-projects/bitcons/">P.J.
Onori</a> (thanks Sam!).</p>
<p>Of course, you could obviously use any piece of technology you like; I simply
picked these four because they allowed me to hit the ground running.</p>
<p><strong>HACKING AWAY</strong></p>
<p>The one piece I heavily added to is Prototype Window.<br>
For instance, I added a drop-down contextual menu to windows, activated when
clicking on the new &lsquo;menu&rsquo; button, next to the &lsquo;close&rsquo;, &lsquo;expand&rsquo; and &lsquo;iconify&rsquo;
buttons.<br>
<img src="/images/contextualmenu.png" alt="home.clicdev.com Contextual
Menu"  />
<br>
These three menu items let the user:</p>
<p>1. Change the background color of the iconified version of the window<br>
<img src="/images/colorpicker.png" alt="home.clicdev.com Color
Picker"  />
<br>
Let&rsquo;s say&hellip;purple<br>
<img src="/images/iconified.png" alt="home.clicdev.com
Iconified"  />
<br>
Well&hellip;it <em>is</em> purple</p>
<p>2. Change the window&rsquo;s overall theme<br>
<a href="http://nexus.zteo.com/files/2006/12/wintheme1.png" title="home.clicdev.com Window Theme 1"><img src="/images/wintheme1.thumbnail.png" alt="home.clicdev.com Window Theme
1"  />
</a> <a href="http://nexus.zteo.com/files/2006/12/wintheme2.png" title="home.clicdev.com Window Theme 2"><img src="/images/wintheme2.thumbnail.png" alt="home.clicdev.com Window Theme
2"  />
</a></p>
<p>3. Reload the content of the window</p>
<p>To create these menus, I went with my usual method of creating HTML elements
that I position and display on demand, instead of re-creating them every time.</p>
<pre><code>![](/images/day.gif); Icon Color

  


![](/images/day.gif) Window Theme

  


![](/images/loop.gif) Reset
</code></pre>
<p>I had to further modify the code of Prototype Window because it did not offer
anything for iconified windows.<br>
What I am doing is hide the actual window, create a square window that is a
representation of the hidden one and slap a relevant icon in the middle of it
-if I manage to retrieve one-.<br>
<em>About this icon</em> : I simply query the server hosting the iconified
application for its default favicon and download it for caching purpose - see
below.</p>
<p>To implement these features, I only added a few hooks to window.js, leaving
Sebastien&rsquo;s code relatively untouched, and piling up my dirty code in cfr.js
instead.</p>
<p><strong>BEHAVIOURS</strong></p>
<ul>
<li>
<p>I had to add a hook to catch the fact that a user is leaving the current webpage, asking them whether they really wish to do this and canceling the event if they do not.<br>
This was easily implemented using Javascript&rsquo;s onbeforeunload(), which happens
to work in all the browsers I tested.</p>
<p>$obfulstr = &ldquo;onbeforeunload=&quot;return &lsquo;For some reason, you are about to leave this page:nIt could be your decision or an application, such as Yahoo, trying to force its way out.nMAKE SURE THAT YOU SAVED YOUR DESKTOP!';&quot;&quot;;</p>
</li>
<li>
<p>The login window itself is simply Mohame&rsquo;s login code embedded within an iframe, which in turn I turned into a CSS window.<br>
<a href="http://nexus.zteo.com/files/2006/12/loginscreen.png" title="home.clicdev.com Login Screen"><img src="/images/loginscreen.thumbnail.png" alt="home.clicdev.com Login
Screen"  />
</a></p>
<p>function cfrNewLogin()</p>
<p>{</p>
<pre><code>_loginwin = _doOpenWindow('Login', ROOTPATH+'login/', false, 340, 240);
</code></pre>
<p>}</p>
</li>
</ul>
<p><strong>AJAX</strong></p>
<p>As you can imagine, Ajax is used fairly heavily. Here is how: all frontend
queries are channeled through a method in cfr.js, called _talkToMe()<br>
This method uses Prototype&rsquo;s Ajax implementation -but you could use any other
implenentation here- to contact the backend.</p>
<pre><code>case 'minimize':





  var iconcolor;





    if(win &amp;&amp; win.element.getAttribute('iconcolor'))





      iconcolor = win.element.getAttribute('iconcolor');





    else





      iconcolor = '-';





    var myAjax = new Ajax.Request(





      'backend/index.php',





      {





        method: 'get',





        parameters:





          'action=minimize&amp;id='+id+'&amp;title='+prepare(message)+'&amp;iconcolor='+prepare(iconcolor)+'&amp;url='+prepare(url),





onComplete: getMinimizeReply





      });





    break;
</code></pre>
<p>The backend class BE, defined in index.php, extends BackEnd which itself
implements low-level communications using Json and/or XML.<br>
The backend has knowledge of the code of the various widgets requested by the
frontend and has the ability to retrieve favicons from other websites. The
latter is done through the very straightforward use of fopen() and
file_get_contents().</p>
<pre><code>// Build path to favicon.ico





preg_match(&quot;/^(http://)?([^/]+)/i&quot;, $url, $matches);





$prepath = $matches[1].$matches[2];





$path = $prepath.'/favicon.ico';





// Does this guy exist?





$bFound = false;





$f = @fopen($path, 'r');





if($f)





{





  // /favicon.ico





  @fclose($f);





  $contents .= @file_get_contents($path);





  axlog(&quot;FOUND CONTENTS=&quot;.strlen($contents));





  if(strlen($contents)&gt;0)





    $bFound = true;





  }





  if(!$bFound)





  {





    // Get page contents





    @fclose($f);





    $contents .= @file_get_contents($url);





    $c = preg_match(&quot;//i&quot;, $contents, $matches);





    if($c &gt; 0)





    {





      $s = &amp;$matches[0];





      $c = preg_match(&quot;/href=(.+?)(['&quot;&gt;])/i&quot;, $s, $matches);





      if($c &gt; 0 )





      {





        $s = str_replace(array(&quot;'&quot;, &quot;&quot;&quot;), array('', ''), $matches[1]);





        // Build new URL





        if(strpos($s, '://')===false)





        {





          if($s[0]=='/')





            $path = $prepath . $s;





          /** @todo 'else : relative path' */





          axlog(&quot;Found relative favicon @ $path&quot;);





        }





        else





        {





          axlog(&quot;Found absolute favicon @ $path&quot;);





          $path = $s;





        }





      }





      else





        $path = 'themes/window.gif';





    }





    else





      $path = 'themes/window.gif';





  }
</code></pre>
<p><strong>DATABASE</strong></p>
<p>Since we are using Mohamed&rsquo;s login script, database connectivity comes for
free.<br>
Note that his script uses one table: <em>maaking_users</em><br>
We need to add our own two tables:</p>
<p><em>maaking_session</em> - each entry in this table will be a user window:</p>
<pre><code>CREATE TABLE `maaking_session` (





 `id` int(11) NOT NULL auto_increment,





`userid` int(11) NOT NULL default '0',





`url` text,





`useTop` tinyint(1) default NULL,





`useLeft` tinyint(1) default NULL,





`top` int(10) default NULL,





`bottom` int(10) default NULL,





`left` int(10) default NULL,





`right` int(10) default NULL,





`title` text,





`width` int(10) default NULL,





`height` int(10) default NULL,





`hidden` tinyint(1) default NULL,





`iconcolor` varchar(10) default NULL,





`contents` text,





`usertheme` varchar(16) default '',





PRIMARY KEY  (`id`),





KEY `userid` (`userid`)





);
</code></pre>
<p>and <em>maaking_favicons</em> :</p>
<pre><code>CREATE TABLE `maaking_favicons` (





`id` int(11) NOT NULL auto_increment,





`url` varchar(255) NOT NULL default '',





`icon` text,





PRIMARY KEY  (`id`),





KEY `url` (`url`)





);
</code></pre>
<p>This is it for now. <a href="http://downloads.sourceforge.net/forums/home.zip?use_mirror=osdn">Download the zip
package</a>,
play with it, let me know what you think or if you have any questions!</p>

                
              </section>

              
              <script>talkyardServerUrl='https:\/\/comments-for-nexus-zteo-com.talkyard.net';</script>
              <script async defer src="https://c1.ty-cdn.net/-/talkyard-comments.min.js"></script>
              
              <div class="talkyard-comments" data-discussion-id="" style="margin-top: 45px;">
                  <noscript>Please enable Javascript to view comments.</noscript>
                  <p style="margin-top: 25px; opacity: 0.9; font-size: 96%">Comments powered by
                  <a href="https://www.talkyard.io">Talkyard</a>.</p>
              </div>
              

              <footer class="post-footer">
                  <div class="post-tags">
            
                  </div>
                
              </footer>

            
                <aside class="post-comments">
    
    
    
</aside>

            
            </div>

            <nav class="post-nav">
                
                    <a class="post-nav-item post-nav-next" href="http://zteo.com/posts/where-is-getelementsbyclassname/">
                        <section class="post-nav-teaser">
                            <span class="post-nav-icon"><i class="fa fa-chevron-left"></i></span>
                            <span class="post-nav-info">
                                <h4 class="post-nav-title">Where is getElementsByClassName()?</h4>
                            </span>
                        </section>
                    </a>
                
                
                    <a class="post-nav-item post-nav-prev" href="http://zteo.com/posts/cd-v2-nextbbs-multi/">
                        <section class="post-nav-teaser">
                            <span class="post-nav-icon"><i class="fa fa-chevron-right"></i></span>
                            <span class="post-nav-info">
                                <h4 class="post-nav-title">C!D v2 = nextBBS multi</h4>
                            </span>
                        </section>
                    </a>
                
                <div class="clear"></div>
            </nav>

        </div>
    </article>
</main>
<script>
window.addEventListener('DOMContentLoaded', () => {
    const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            const id = entry.target.getAttribute('id');

            if (entry.intersectionRatio > 0) {
                clearActiveStatesInTableOfContents();
                document.querySelector(`aside nav li a[href="#${id}"]`).parentElement.classList.add('active');
            }
        });
    });

    document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
        observerForTableOfContentActiveState.observe(section);
    });
});

function clearActiveStatesInTableOfContents() {
    document.querySelectorAll('aside nav li').forEach((section) => {
        section.classList.remove('active');
    });
}
</script>

                <div id="body-class" style="display: none;"></div>
                <footer id="footer">
                    <section class="credits">
                        <span class="credits-license"><i class="fa fa-copyright"></i>2020 The Nexus
                    </span>
                    </section>
                </footer>
                

                

                
                <div class="overlay"></div>
            </div>
        </section>

<video autoplay loop id="video-background" muted plays-inline>
<source src="http://zteo.com/images/hd0198.mp4" type="video/mp4">
</video>

<script src="/mermaid/mermaid.js?1604186989"></script>
<script async src="http://zteo.com//js/main.js"></script>
<script async src="http://zteo.com//js/basicLightbox.min.js"></script>

<script>


function defer(method) {
    if (window.jQuery) {
        method();
    } else {
        setTimeout(function() { defer(method) }, 50);
    }
}
defer(function() {
    jQuery.fn.doubleTapToGo = function( params ) {
        if( !( 'ontouchstart' in window ) &&
            !navigator.msMaxTouchPoints &&
            !navigator.userAgent.toLowerCase().match( /windows phone os 7/i ) ) return false;

        this.each( function()
        {
            var curItem = false;

            jQuery( this ).on( 'click', function( e )
            {
                var item = jQuery( this );
                if( item[ 0 ] != curItem[ 0 ] )
                {
                    e.preventDefault();
                    curItem = item;
                }
            });

            jQuery( document ).on( 'click touchstart MSPointerDown', function( e )
            {
                var resetItem = true,
                    parents	  = jQuery( e.target ).parents();

                for( var i = 0; i < parents.length; i++ )
                    if( parents[ i ] == curItem[ 0 ] )
                        resetItem = false;

                if( resetItem )
                    curItem = false;
            });
        });
        return this;
    };
    jQuery( '#nav li:has(ul)' ).doubleTapToGo();
});
</script>

<script>
    mermaid.initialize({ startOnLoad: true });
</script>




  <noscript><link rel="stylesheet" href="http://zteo.com//css/main.css"></noscript>
</body>
</html>

